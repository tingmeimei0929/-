<template>
  <el-form class="login-type" :rules="rules" :model="ruleForm" ref="ruleForm">
    <el-form-item  class="smsPush" prop="tel" >
      <div class="number">+86</div>
      <div class="phoneInput" >
        <el-input type="text"
               placeholder="手机号码"
               name="tel"
               id="tel" v-model="ruleForm.tel">
        </el-input>
      </div>
    </el-form-item>
    <el-form-item class="smsPush last"  prop="smscode">
        <el-input type="text"
               placeholder="短信验证码"
               name="smscode"
               class="smsInput "
               id="smscode" v-model="ruleForm.smscode">
        </el-input>
          <el-button :disabled="isDisabled"
                         @click="sendCode">{{content}}</el-button>
    </el-form-item>
    <!-- <div class="small"
         v-show="prompt">
      <i class="el-icon-alibaocuo"></i>
      <span class="errorPrompt">{{errorMsg}}</span>
    </div> -->
    <el-button class="button" @click="submitForm('ruleForm')">立即登录/注册</el-button>
    <div class="prompt">
      <div class="prompt-top">
        <div class="sms-link"><a @click="usercode">用户名密码登录</a></div>
        <div class="other-login-type">
          <a @click="code">收不到验证码？</a>
        </div>
      </div>
      <fieldset>
        <legend>其他登入方式</legend>
      </fieldset>
      <div class="other-type">
        <a href="/pass/sns/login/auth?appid=100284651&&callback=https%3A%2F%2Forder.mi.com%2Flogin%2Fcallback%3Ffollowup%3Dhttps%253A%252F%252Fwww.mi.com%252Findex.html%26sign%3DMjM0MWU0NjBlOTU1YzY4NGQzOTc3MDk4N2M2MjQ5Y2ZiZTMxNTFlZQ%2C%2C&sid=mi_eshop"
           class="btn-qq"><i class="el-icon-aliQQ"></i></a>
        <a href="/pass/sns/login/auth?appid=2996826273&&callback=https%3A%2F%2Forder.mi.com%2Flogin%2Fcallback%3Ffollowup%3Dhttps%253A%252F%252Fwww.mi.com%252Findex.html%26sign%3DMjM0MWU0NjBlOTU1YzY4NGQzOTc3MDk4N2M2MjQ5Y2ZiZTMxNTFlZQ%2C%2C&sid=mi_eshop"
           class="btn-weibo"><i class="el-icon-aliweibo"></i></a>
        <a href="/pass/sns/login/auth?appid=wxxmzh&scope=snsapi_login&callback=https%3A%2F%2Forder.mi.com%2Flogin%2Fcallback%3Ffollowup%3Dhttps%253A%252F%252Fwww.mi.com%252Findex.html%26sign%3DMjM0MWU0NjBlOTU1YzY4NGQzOTc3MDk4N2M2MjQ5Y2ZiZTMxNTFlZQ%2C%2C&sid=mi_eshop"
           class="btn-zhifubao"><i class="el-icon-alizhifubao1"></i></a>
        <a href="/pass/sns/login/auth?appid=2088011127562160&&callback=https%3A%2F%2Forder.mi.com%2Flogin%2Fcallback%3Ffollowup%3Dhttps%253A%252F%252Fwww.mi.com%252Findex.html%26sign%3DMjM0MWU0NjBlOTU1YzY4NGQzOTc3MDk4N2M2MjQ5Y2ZiZTMxNTFlZQ%2C%2C&sid=mi_eshop"
           class="btn-weixin"><i class="el-icon-aliweixin2"></i></a>
      </div>
    </div>
  </el-form>
</template>

<script>
export default {
  name: 'SMS',
  data () {
    // <!--验证手机号是否合法-->
    const checkTel = (rule, value, callback) => {
      if (value === '') {
        callback(new Error('请输入手机号码'))
      } else if (!this.checkMobile(value)) {
        callback(new Error('请输入正确的11位手机号码'))
      } else {
        callback()
      }
    }
    //  <!--验证码是否为空-->
    const checkSmscode = (rule, value, callback) => {
      if (value === '') {
        callback(new Error('请输入短信验证码'))
      } else {
        callback()
      }
    }
    return {
      ruleForm: {
        tel: '',
        smscode: ''
      },
      rules: {
        tel: [
          { required: true, message: '请输入手机号', trigger: 'blur' },
          { validator: checkTel, trigger: 'blur' }
        ],
        smscode: [
          { required: true, message: '请输入短信验证码', trigger: 'blur' },
          { validator: checkSmscode, trigger: 'blur' }
        ]
      },
      isDisabled: false, // 是否禁止点击发送验证码按钮
      content: '发送验证码',
      flag: true
    }
  },
  methods: {
    usercode () {
      this.$router.push({
        path: '/Login/Account'
      })
    },
    code () {
      this.$router.push({
        path: '/CodeRules'
      })
    },
    // <!--发送验证码-->
    sendCode () {
      // 1、时间开始倒数
      // 2、按钮进入禁用状态
      // 3、如何倒计时结束 按钮回复可用状态 按钮文字变成重新发送
      // 4、倒计时的过程中 按钮文字为 重新发送+多少秒
      // countDown () {
    //   if (!this.canClick) {
    //     return
    //   }
    //   this.canClick = false
    //   this.content = '重新发送(' + this.totalTime + ')'
    //   const clock = window.setInterval(() => {
    //     this.totalTime--
    //     this.content = '重新发送(' + this.totalTime + ')'
    //     if (this.totalTime < 0) {
    //       window.clearInterval(clock)
    //       this.content = '发送验证码'
    //       this.totalTime = 60
    //       this.canClick = true // 重新开启
    //     }
    //   }, 1000)
    // }
      const tel = this.ruleForm.tel
      if (this.checkMobile(tel)) {
        console.log(tel)
        let time = 60
        this.content = '重新发送(' + time + ')'
        this.isDisabled = true
        if (this.flag) {
          this.flag = false
          const timer = setInterval(() => {
            time--
            // this.content = `重新发送(${this.time})`
            this.content = '重新发送(' + time + ')'
            if (time === 0) {
              clearInterval(timer)
              this.content = '发送验证码'
              this.isDisabled = false
              this.flag = true
            }
          }, 1000)
        }
      }
    },
    // 验证手机号
    checkMobile (str) {
      const reg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/
      if (reg.test(str)) {
        return true
      } else {
        return false
      }
    },
    // <!--提交登录-->
    submitForm (formName) {
      this.$refs[formName].validate(valid => {
        if (valid) {
          setTimeout(() => {
            this.$message({
              message: '登录成功！',
              type: 'success'
            })
          }, 400)
        } else {
          console.log('error submit!!')
          return false
        }
      })
    }
  }
}
</script>

<style lang="scss" scoped>
@import url("../assets/scss/login.scss");
</style>
